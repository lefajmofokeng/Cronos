

<!-- Google Font Import for Inter -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
/* --- IT Market Insights Dashboard Styles --- */
/* * Unique prefix 'itmi-' is used for all classes 
 * to prevent conflicts with other codebases.
 */

 * {
    margin: 0;
 }

/* --- Base & Fonts --- */
.itmi-font-wrapper {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    background-color: #14172B;
    color: #F0F0F0;
    padding: 24px 100px;
    border-radius: 12px;
}

/* --- Custom Wrapper Tag --- */
/* This is the special wrapper tag you requested */
it-market-insights-container {
    display: block;
    width: 100%;
}

/* --- Utility Colors --- */
.itmi-text-green {
    color: #0ECB81;
}
.itmi-text-red {
    color: #F6465D;
}

/* --- Header Stats Bar --- */
.itmi-header-bar {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    align-items: center;
    padding-bottom: 24px;
    border-bottom: 1px solid #282D48;
}

.itmi-header-stat {
    display: flex;
    align-items: baseline;
    gap: 8px;
    white-space: nowrap;
}

.itmi-header-stat-label {
    font-size: 13px;
    color: #8A91B5;
    font-weight: 500;
}

.itmi-header-stat-value {
    font-size: 14px;
    color: #F0F0F0;
    font-weight: 600;
}

.itmi-header-stat-value.itmi-fear-index {
    display: flex;
    align-items: center;
    gap: 6px;
}

.itmi-fear-gauge {
    width: 20px;
    height: 10px;
    background: linear-gradient(to right, #F6465D, #F6A000, #0ECB81);
    border-radius: 2px;
    position: relative;
    border: 1px solid #444;
}

.itmi-fear-needle {
    width: 2px;
    height: 12px;
    background: #FFFFFF;
    position: absolute;
    bottom: -1px;
    left: 72%; /* 72 is the "Bullish" value */
    transform: translateX(-50%);
    border-radius: 2px;
}

/* --- Trending Section --- */
.itmi-trending-section {
    padding: 24px 0;
}

.itmi-trending-title {
    font-size: 24px;
    font-weight: 700;
    color: #FFFFFF;
    margin: 0 0 20px 0;
}

.itmi-trending-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
}

.itmi-card {
    background-color: #1E223D;
    border-radius: 12px;
    padding: 20px;
    /* --- Abstract background gradients to mimic the image --- */
    background-position: top right;
    background-repeat: no-repeat;
    background-size: 80px 80px;
}

/* Card-specific background gradients */
.itmi-card-1 {
    background-image: radial-gradient(circle at 100% 0, rgba(53, 112, 247, 0.15), transparent 70%);
}
.itmi-card-2 {
    background-image: radial-gradient(circle at 100% 0, rgba(138, 145, 181, 0.15), transparent 70%);
}
.itmi-card-3 {
    background-image: radial-gradient(circle at 100% 0, rgba(14, 203, 129, 0.15), transparent 70%);
}
.itmi-card-4 {
    background-image: radial-gradient(circle at 100% 0, rgba(246, 70, 93, 0.15), transparent 70%);
}


.itmi-card-header {
    margin-bottom: 24px;
}

.itmi-card-title {
    font-size: 18px;
    font-weight: 600;
    color: #FFFFFF;
    margin: 0;
}

.itmi-card-subtitle {
    font-size: 13px;
    color: #8A91B5;
    margin: 4px 0 0 0;
}

.itmi-card-list {
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.itmi-card-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.itmi-card-item-name-group {
    display: flex;
    align-items: center;
    gap: 12px;
}

.itmi-card-item-icon {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background-color: #282D48;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 12px;
    color: #FFFFFF;
}

.itmi-card-item-icon svg {
    width: 18px;
    height: 18px;
    fill: #FFFFFF;
}

.itmi-card-item-name {
    font-size: 15px;
    font-weight: 600;
    color: #FFFFFF;
}

.itmi-card-item-value-group {
    text-align: right;
}

.itmi-card-item-value {
    font-size: 15px;
    font-weight: 600;
    color: #FFFFFF;
}

.itmi-card-item-change {
    font-size: 13px;
    font-weight: 500;
    margin-top: 2px;
}

/* --- Main Table Section --- */
.itmi-table-controls {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: center;
    gap: 16px;
    padding: 24px 0;
}

.itmi-filter-group {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.itmi-filter-btn {
    background-color: #282D48;
    color: #F0F0F0;
    border: none;
    padding: 8px 16px;
    border-radius: 18px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    transition: background-color 0.2s ease;
}

.itmi-filter-btn:hover {
    background-color: #3A4063;
}

.itmi-filter-btn.itmi-active {
    background-color: #3570F7;
    color: #FFFFFF;
}

.itmi-dropdown-group {
    display: flex;
    gap: 8px;
}

/* New Dropdown Styles */
.itmi-dropdown {
    position: relative;
    display: inline-block;
}

.itmi-dropdown-content {
    display: none;
    position: absolute;
    background-color: #282D48;
    min-width: 160px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    border-radius: 8px;
    padding: 8px 0;
    z-index: 1;
    right: 0; /* Align to the right */
    margin-top: 4px;
}

.itmi-dropdown-item {
    color: #F0F0F0;
    padding: 10px 16px;
    text-decoration: none;
    display: block;
    font-size: 14px;
    font-weight: 500;
    white-space: nowrap;
    cursor: pointer;
}

.itmi-dropdown-item:hover {
    background-color: #3A4063;
}

.itmi-dropdown-content-show {
    display: block;
}
/* End New Dropdown Styles */

.itmi-dropdown-btn {
    background-color: #282D48;
    color: #F0F0F0;
    border: none;
    padding: 8px 12px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 6px;
}

.itmi-dropdown-btn svg {
    width: 12px;
    height: 12px;
    fill: #8A91B5;
}

/* --- Data Table --- */
.itmi-data-table-wrapper {
    overflow-x: auto; /* For responsiveness on small screens */
}

.itmi-data-table {
    width: 100%;
    border-collapse: collapse;
    min-width: 800px; /* Ensure table has a min width */
}

.itmi-data-table th,
.itmi-data-table td {
    padding: 16px 12px;
    text-align: left;
    white-space: nowrap;
}

.itmi-data-table th {
    font-size: 13px;
    color: #8A91B5;
    font-weight: 500;
    border-bottom: 1px solid #282D48;
}

/* Align table headers */
.itmi-data-table th:nth-child(1),
.itmi-data-table td:nth-child(1) {
    width: 4%;
    text-align: center;
}
.itmi-data-table th:nth-child(3),
.itmi-data-table td:nth-child(3),
.itmi-data-table th:nth-child(4),
.itmi-data-table td:nth-child(4),
.itmi-data-table th:nth-child(6),
.itmi-data-table td:nth-child(6),
.itmi-data-table th:nth-child(7),
.itmi-data-table td:nth-child(7) {
    text-align: right;
}

.itmi-data-table td {
    font-size: 15px;
    font-weight: 600;
    color: #F0F0F0;
}

.itmi-data-table tbody tr {
    border-bottom: 1px solid #282D48;
    transition: background-color 0.2s ease;
}

.itmi-data-table tbody tr:hover {
    background-color: #282D48;
}

.itmi-table-sector-group {
    display: flex;
    align-items: center;
    gap: 12px;
}

.itmi-table-icon {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background-color: #282D48;
    display: flex;
    align-items: center;
    justify-content: center;
}

.itmi-table-icon svg {
    width: 18px;
    height: 18px;
    fill: #FFFFFF;
}

.itmi-table-sector-name {
    font-size: 15px;
    font-weight: 600;
    color: #F0F0F0;
}

.itmi-table-sector-symbol {
    font-size: 14px;
    font-weight: 500;
    color: #8A91B5;
    margin-left: 4px;
}

.itmi-sparkline-chart svg {
    width: 100px;
    height: 30px;
}

.itmi-trade-link {
    color: #3570F7;
    text-decoration: none;
    font-weight: 600;
    font-size: 14px;
}

.itmi-star-icon {
    width: 20px;
    height: 20px;
    fill: #8A91B5;
    cursor: pointer;
}
.itmi-star-icon:hover {
    fill: #F6A000;
}

/* Style for a favorited star */
.itmi-star-icon.itmi-favorited {
    fill: #F6A000;
}

</style>

<!-- 
  This is the custom tag wrapper you requested.
  You can copy everything from here down.
-->
<it-market-insights-container>
    <div class="itmi-font-wrapper">

        <!-- --- HEADER STATS BAR --- -->
        <header class="itmi-header-bar">
            <div class="itmi-header-stat">
                <span class="itmi-header-stat-label">Global IT Spend (YTD):</span>
                <span class="itmi-header-stat-value">$4.72T</span>
                <span class="itmi-header-stat-value itmi-text-green">+1.8%</span>
            </div>
            <div class="itmi-header-stat">
                <span class="itmi-header-stat-label">Cloud Spend (Q3 '25):</span>
                <span class="itmi-header-stat-value">$68.1B</span>
            </div>
            <div class="itmi-header-stat">
                <span class="itmi-header-stat-label">Top Skill Demand:</span>
                <span class="itmi-header-stat-value">AI/ML (38.2%)</span>
            </div>
            <div class="itmi-header-stat">
                <span class="itmi-header-stat-label">Avg. Dev Salary (US):</span>
                <span class="itmi-header-stat-value">$134,500</span>
            </div>
            <div class="itmi-header-stat">
                <span class="itmi-header-stat-label">Open Source Projects:</span>
                <span class="itmi-header-stat-value">512M</span>
            </div>
            <div class="itmi-header-stat">
                <span class="itmi-header-stat-label">C-Suite AI Index:</span>
                <span class="itmi-header-stat-value itmi-fear-index">
                    <div class="itmi-fear-gauge">
                        <div class="itmi-fear-needle"></div>
                    </div>
                    72 (Bullish)
                </span>
            </div>
        </header>

        <!-- --- TRENDING SECTION --- -->
        <section class="itmi-trending-section">
            <h2 class="itmi-trending-title">Trending Today</h2>
            
            <div class="itmi-trending-grid">
                
                <!-- Card 1: Hot Technologies -->
                <div class="itmi-card itmi-card-1">
                    <div class="itmi-card-header">
                        <h3 class="itmi-card-title">Hot Technologies</h3>
                        <p class="itmi-card-subtitle">Fastest-growing tech skills (YoY)</p>
                    </div>
                    <div class="itmi-card-list">
                        <!-- Item 1 -->
                        <div class="itmi-card-item">
                            <div class="itmi-card-item-name-group">
                                <span class="itmi-card-item-icon">R</span>
                                <span class="itmi-card-item-name">Rust</span>
                            </div>
                            <div class="itmi-card-item-value-group">
                                <div class="itmi-card-item-value">1.4M Devs</div>
                                <div class="itmi-card-item-change itmi-text-green">+22.1%</div>
                            </div>
                        </div>
                        <!-- Item 2 -->
                        <div class="itmi-card-item">
                            <div class="itmi-card-item-name-group">
                                <span class="itmi-card-item-icon">W</span>
                                <span class="itmi-card-item-name">WebAssembly</span>
                            </div>
                            <div class="itmi-card-item-value-group">
                                <div class="itmi-card-item-value">850k Devs</div>
                                <div class="itmi-card-item-change itmi-text-green">+19.4%</div>
                            </div>
                        </div>
                        <!-- Item 3 -->
                        <div class="itmi-card-item">
                            <div class="itmi-card-item-name-group">
                                <span class="itmi-card-item-icon">Go</span>
                                <span class="itmi-card-item-name">Go</span>
                            </div>
                            <div class="itmi-card-item-value-group">
                                <div class="itmi-card-item-value">2.1M Devs</div>
                                <div class="itmi-card-item-change itmi-text-green">+15.8%</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Card 2: Industry Buzz -->
                <div class="itmi-card itmi-card-2">
                    <div class="itmi-card-header">
                        <h3 class="itmi-card-title">Industry Buzz</h3>
                        <p class="itmi-card-subtitle">Market size forecasts</p>
                    </div>
                    <div class="itmi-card-list">
                        <!-- Item 1 -->
                        <div class="itmi-card-item">
                            <div class="itmi-card-item-name-group">
                                <span class="itmi-card-item-icon">
                                    <svg viewBox="0 0 24 24"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"></path></svg>
                                </span>
                                <span class="itmi-card-item-name">Generative AI</span>
                            </div>
                            <div class="itmi-card-item-value-group">
                                <div class="itmi-card-item-value">$1.3T</div>
                                <div class="itmi-card-item-change" style="color: #8A91B5;">by 2032</div>
                            </div>
                        </div>
                        <!-- Item 2 -->
                        <div class="itmi-card-item">
                            <div class="itmi-card-item-name-group">
                                <span class="itmi-card-item-icon">
                                     <svg viewBox="0 0 24 24"><path d="M7 2v2h2v-2h-2zm4 0v2h2v-2h-2zm4 0v2h2v-2h-2zm-8 4v2h2v-2h-2zm4 0v2h2v-2h-2zm4 0v2h2v-2h-2zm-8 4v2h2v-2h-2zm4 0v2h2v-2h-2zm4 0v2h2v-2h-2zm-8 4v2h2v-2h-2zm4 0v2h2v-2h-2zm4 0v2h2v-2h-2zm-8 4v2h2v-2h-2zm4 0v2h2v-2h-2zm4 0v2h2v-2h-2z"></path></svg>
                                </span>
                                <span class="itmi-card-item-name">Quantum</span>
                            </div>
                            <div class="itmi-card-item-value-group">
                                <div class="itmi-card-item-value">$5.3B</div>
                                <div class="itmi-card-item-change" style="color: #8A91B5;">by 2029</div>
                            </div>
                        </div>
                        <!-- Item 3 -->
                        <div class="itmi-card-item">
                            <div class="itmi-card-item-name-group">
                                <span class="itmi-card-item-icon">
                                    <svg viewBox="0 0 24 24"><path d="M19 8H5c-1.66 0-3 1.34-3 3v6h4v-3h12v3h4v-6c0-1.66-1.34-3-3-3zM5 16h14v-5H5v5zm14-7H5c-1.1 0-2 .9-2 2v6c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-6c0-1.1-.9-2-2-2z"></path></svg>
                                </span>
                                <span class="itmi-card-item-name">Edge AI</span>
                            </div>
                            <div class="itmi-card-item-value-group">
                                <div class="itmi-card-item-value">$2.7B</div>
                                <div class="itmi-card-item-change" style="color: #8A91B5;">by 2028</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Card 3: Top Market Movers -->
                <div class="itmi-card itmi-card-3">
                    <div class="itmi-card-header">
                        <h3 class="itmi-card-title">Top Market Movers</h3>
                        <p class="itmi-card-subtitle">Biggest gainers (1Y Change)</p>
                    </div>
                    <div class="itmi-card-list">
                        <!-- Item 1 -->
                        <div class="itmi-card-item">
                            <div class="itmi-card-item-name-group">
                                <span class="itmi-card-item-icon" style="background-color: #0ECB81; color: #111;">NV</span>
                                <span class="itmi-card-item-name">NVIDIA</span>
                            </div>
                            <div class="itmi-card-item-value-group">
                                <div class="itmi-card-item-value">$3.1T</div>
                                <div class="itmi-card-item-change itmi-text-green">+188.2%</div>
                            </div>
                        </div>
                        <!-- Item 2 -->
                        <div class="itmi-card-item">
                            <div class="itmi-card-item-name-group">
                                <span class="itmi-card-item-icon" style="background-color: #F6465D; color: #FFF;">AV</span>
                                <span class="itmi-card-item-name">Broadcom</span>
                            </div>
                            <div class="itmi-card-item-value-group">
                                <div class="itmi-card-item-value">$820B</div>
                                <div class="itmi-card-item-change itmi-text-green">+95.1%</div>
                            </div>
                        </div>
                        <!-- Item 3 -->
                        <div class="itmi-card-item">
                            <div class="itmi-card-item-name-group">
                                <span class="itmi-card-item-icon" style="background-color: #F6A000; color: #111;">PA</span>
                                <span class="itmi-card-item-name">Palo Alto</span>
                            </div>
                            <div class="itmi-card-item-value-group">
                                <div class="itmi-card-item-value">$110B</div>
                                <div class="itmi-card-item-change itmi-text-green">+72.4%</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Card 4: New Launches -->
                <div class="itmi-card itmi-card-4">
                    <div class="itmi-card-header">
                        <h3 class="itmi-card-title">Notable Launches</h3>
                        <p class="itmi-card-subtitle">Recent model/product releases</p>
                    </div>
                    <div class="itmi-card-list">
                        <!-- Item 1 -->
                        <div class="itmi-card-item">
                            <div class="itmi-card-item-name-group">
                                <span class="itmi-card-item-icon" style="background-color: #4285F4;">G</span>
                                <span class="itmi-card-item-name">Project Astra</span>
                            </div>
                            <div class="itmi-card-item-value-group">
                                <div class="itmi-card-item-value">Google</div>
                                <div class="itmi-card-item-change" style="color: #8A91B5;">Q3 2025</div>
                            </div>
                        </div>
                        <!-- Item 2 -->
                        <div class="itmi-card-item">
                            <div class="itmi-card-item-name-group">
                                <span class="itmi-card-item-icon" style="background-color: #1877F2;">M</span>
                                <span class="itmi-card-item-name">Llama 4</span>
                            </div>
                            <div class="itmi-card-item-value-group">
                                <div class="itmi-card-item-value">Meta</div>
                                <div class="itmi-card-item-change" style="color: #8A91B5;">Q4 2025</div>
                            </div>
                        </div>
                        <!-- Item 3 -->
                        <div class="itmi-card-item">
                            <div class="itmi-card-item-name-group">
                                <span class="itmi-card-item-icon" style="background-color: #10A37F;">O</span>
                                <span class="itmi-card-item-name">GPT-5</span>
                            </div>
                            <div class="itmi-card-item-value-group">
                                <div class="itmi-card-item-value">OpenAI</div>
                                <div class="itmi-card-item-change" style="color: #8A91B5;">Q1 2026</div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </section>

        <!-- --- MAIN TABLE SECTION --- -->
        <section class="itmi-table-section">
            
            <!-- Controls -->
            <div class="itmi-table-controls">
                <div class="itmi-filter-group" id="itmi-filter-group">
                    <button class="itmi-filter-btn itmi-active" data-filter="All Sectors">All Sectors</button>
                    <button class="itmi-filter-btn" data-filter="Top Growth">Top Growth</button>
                    <button class="itmi-filter-btn" data-filter="Top R&D">Top R&D</button>
                    <button class="itmi-filter-btn" data-filter="New">New</button>
                    <button class="itmi-filter-btn" data-filter="Favorites">Favorites</button>
                </div>
                <div class="itmi-dropdown-group">
                    <!-- Dropdown 1: Currency -->
                    <div class="itmi-dropdown">
                        <button class="itmi-dropdown-btn" data-toggle="itmi-currency-dropdown" id="itmi-currency-btn">
                            USD
                            <svg viewBox="0 0 24 24" class="itmi-dropdown-caret"><path d="M7 10l5 5 5-5z"></path></svg>
                        </button>
                        <div class="itmi-dropdown-content" id="itmi-currency-dropdown">
                            <a class="itmi-dropdown-item" data-value="USD">USD</a>
                            <a class="itmi-dropdown-item" data-value="EUR">EUR</a>
                            <a class="itmi-dropdown-item" data-value="BTC">BTC</a>
                        </div>
                    </div>
                    <!-- Dropdown 2: Categories -->
                    <div class="itmi-dropdown">
                        <button class="itmi-dropdown-btn" data-toggle="itmi-category-dropdown" id="itmi-category-btn">
                            All Categories
                            <svg viewBox="0 0 24 24" class="itmi-dropdown-caret"><path d="M7 10l5 5 5-5z"></path></svg>
                        </button>
                        <div class="itmi-dropdown-content" id="itmi-category-dropdown">
                            <a class="itmi-dropdown-item" data-value="All Categories">All Categories</a>
                            <a class="itmi-dropdown-item" data-value="Tech">Tech</a>
                            <a class="itmi-dropdown-item" data-value="Finance">Finance</a>
                            <a class="itmi-dropdown-item" data-value="SaaS">SaaS</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Data Table -->
            <div class="itmi-data-table-wrapper">
                <table class="itmi-data-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Sector</th>
                            <th>Market Cap</th>
                            <th>YoY Growth</th>
                            <th>1Y Trend</th>
                            <th>Key Player</th>
                            <th>R&D Spend (TTM)</th>
                            <th>Trade</th>
                            <th></th> <!-- Star Icon -->
                        </tr>
                    </thead>
                    <tbody id="itmi-table-body">
                        <!-- Rows will be dynamically injected here by JavaScript -->
                    </tbody>
                </table>
            </div>
        </section>

    </div>
</it-market-insights-container>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- 1. Data Source ---
    // All table data is stored here.
    // 'categories' array is used for filtering.
    let allSectorData = [
        {
            id: 1,
            rank: 1,
            iconSvg: `<svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm3.5 12.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm-7 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm3.5 4c-2.33 0-4.31-1.46-5.11-3.5h10.22c-.8 2.04-2.78 3.5-5.11 3.5z"></path></svg>`,
            name: 'Artificial Intelligence',
            symbol: 'AI',
            marketCap: '$2.8T',
            yoyGrowth: 34.5,
            sparklinePath: 'M 0 25 Q 10 15, 20 18 T 40 20 T 60 10 T 80 8 T 100 5',
            keyPlayer: 'OpenAI',
            rdSpend: '$20B+ (est)',
            favorite: false,
            categories: ['Top Growth', 'Top R&D', 'New']
        },
        {
            id: 2,
            rank: 2,
            iconSvg: `<svg viewBox="0 0 24 24"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"></path></svg>`,
            name: 'Cloud Computing',
            symbol: 'CLOUD',
            marketCap: '$2.1T',
            yoyGrowth: 18.2,
            sparklinePath: 'M 0 28 Q 10 20, 20 22 T 40 18 T 60 15 T 80 10 T 100 12',
            keyPlayer: 'Microsoft (Azure)',
            rdSpend: '$27.1B',
            favorite: true,
            categories: ['Top Growth', 'Top R&D']
        },
        {
            id: 3,
            rank: 3,
            iconSvg: `<svg viewBox="0 0 24 24"><path d="M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM9 4h6v2H9V4zm6 16H9v-2h6v2zm-1-4H8v-6h6v6z"></path></svg>`,
            name: 'Semiconductors',
            symbol: 'SEMI',
            marketCap: '$4.2T',
            yoyGrowth: 28.1,
            sparklinePath: 'M 0 20 Q 10 25, 20 15 T 40 18 T 60 5 T 80 10 T 100 3',
            keyPlayer: 'NVIDIA',
            rdSpend: '$8.9B',
            favorite: false,
            categories: ['Top Growth']
        },
        {
            id: 4,
            rank: 4,
            iconSvg: `<svg viewBox="0 0 24 24"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"></path></svg>`,
            name: 'Cybersecurity',
            symbol: 'CYBER',
            marketCap: '$345B',
            yoyGrowth: 14.7,
            sparklinePath: 'M 0 28 Q 10 22, 20 18 T 40 20 T 60 14 T 80 16 T 100 10',
            keyPlayer: 'Palo Alto Networks',
            rdSpend: '$1.9B',
            favorite: false,
            categories: ['Top Growth']
        },
        {
            id: 5,
            rank: 5,
            iconSvg: `<svg viewBox="0 0 24 24"><path d="M21 18v1c0 1.1-.9 2-2 2H5c-1.11 0-2-.9-2-2V5c0-1.1.89-2 2-2h14c1.1 0 2 .9 2 2v1h-9c-1.11 0-2 .9-2 2v8c0 1.1.89 2 2 2h9zm-9-8h11V5H12v5zm4 4H4v6h12v-6z"></path></svg>`,
            name: 'SaaS',
            symbol: 'SAAS',
            marketCap: '$1.9T',
            yoyGrowth: 16.8,
            sparklinePath: 'M 0 25 Q 10 20, 20 18 T 40 15 T 60 12 T 80 14 T 100 8',
            keyPlayer: 'Salesforce',
            rdSpend: '$9.8B',
            favorite: false,
            categories: ['Top R&D']
        },
        {
            id: 6,
            rank: 6,
            iconSvg: `<svg viewBox="0 0 24 24"><path d="M17 18c-1.11 0-2 .9-2 2s.89 2 2 2 2-.9 2-2-.89-2-2-2zm-10 0c-1.11 0-2 .9-2 2s.89 2 2 2 2-.9 2-2-.89-2-2-2zm-1.02-14h1.04l2.71 4.93L12 6H5.21l-.94-2H1v2h2.2l3.41 7H15c.55 0 1 .45 1 1s-.45 1-1 1H8.1l-.94 2H18v-2H9.7l1.06-2H17c1.65 0 3-1.35 3-3V6c0-1.65-1.35-3-3-3H9.42l-.94-2H3.42z"></path></svg>`,
            name: 'E-commerce',
            symbol: 'ECOM',
            marketCap: '$3.5T',
            yoyGrowth: -9.4,
            sparklinePath: 'M 0 5 Q 10 12, 20 10 T 40 18 T 60 20 T 80 25 T 100 28',
            keyPlayer: 'Amazon',
            rdSpend: '$85.5B',
            favorite: false,
            categories: ['Top R&D']
        },
        {
            id: 7,
            rank: 7,
            iconSvg: `<svg viewBox="0 0 24 24"><path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zm0-8h14V7H7v2z"></path></svg>`,
            name: 'Quantum Computing',
            symbol: 'QCOM',
            marketCap: '$5.3B',
            yoyGrowth: 25.0,
            sparklinePath: 'M 0 25 Q 10 10, 20 15 T 40 5 T 60 10 T 80 3 T 100 5',
            keyPlayer: 'IonQ',
            rdSpend: '$150M',
            favorite: false,
            categories: ['New', 'Top Growth']
        }
    ];

    // --- 2. State ---
    let currentFilter = 'All Sectors'; // Default filter

    // --- 3. DOM References ---
    const tableBody = document.getElementById('itmi-table-body');
    const filterButtonGroup = document.getElementById('itmi-filter-group');
    const filterButtons = document.querySelectorAll('.itmi-filter-btn');

    // New DOM References for Dropdowns
    const dropdownButtons = document.querySelectorAll('.itmi-dropdown-btn');
    const currencyBtn = document.getElementById('itmi-currency-btn');
    const categoryBtn = document.getElementById('itmi-category-btn');

    // --- 4. Render Function ---
    /**
     * Clears and re-renders the table based on the provided data array.
     * @param {Array} dataToRender - The array of sector objects to display.
     */
    function renderTable(dataToRender) {
        if (!tableBody) return;
        tableBody.innerHTML = ''; // Clear existing table rows

        if (dataToRender.length === 0) {
            tableBody.innerHTML = `<tr><td colspan="9" style="text-align: center; padding: 20px; color: #8A91B5;">No items match this filter.</td></tr>`;
            return;
        }

        dataToRender.forEach(item => {
            const row = document.createElement('tr');
            
            const yoyColorClass = item.yoyGrowth >= 0 ? 'itmi-text-green' : 'itmi-text-red';
            const yoySign = item.yoyGrowth >= 0 ? '+' : '';
            const favoritedClass = item.favorite ? 'itmi-favorited' : '';

            row.innerHTML = `
                <td>${item.rank}</td>
                <td>
                    <div class="itmi-table-sector-group">
                        <span class="itmi-table-icon">
                            ${item.iconSvg}
                        </span>
                        <span class="itmi-table-sector-name">${item.name}<span class="itmi-table-sector-symbol">${item.symbol}</span></span>
                    </div>
                </td>
                <td>${item.marketCap}</td>
                <td class="${yoyColorClass}">${yoySign}${item.yoyGrowth}%</td>
                <td class="itmi-sparkline-chart">
                    <svg class="${yoyColorClass}" stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 100 30">
                        <path d="${item.sparklinePath}"></path>
                    </svg>
                </td>
                <td>${item.keyPlayer}</td>
                <td>${item.rdSpend}</td>
                <td><a href="#" class="itmi-trade-link">Details</a></td>
                <td>
                    <!-- Use data-id to link star to data item -->
                    <svg class="itmi-star-icon ${favoritedClass}" data-id="${item.id}" viewBox="0 0 24 24">
                        <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"></path>
                    </svg>
                </td>
            `;
            tableBody.appendChild(row);
        });
    }

    // --- 5. Filter and Re-render ---
    /**
     * Filters the main data based on the currentFilter and calls renderTable.
     */
    function filterAndRender() {
        let filteredData;

        if (currentFilter === 'All Sectors') {
            filteredData = allSectorData;
        } else if (currentFilter === 'Favorites') {
            filteredData = allSectorData.filter(item => item.favorite);
        } else {
            filteredData = allSectorData.filter(item => item.categories.includes(currentFilter));
        }

        renderTable(filteredData);
    }

    // --- 6. Event Handlers ---
    
    /**
     * Handles clicks on the filter button group.
     */
    function handleFilterClick(e) {
        const clickedButton = e.target.closest('.itmi-filter-btn');
        if (!clickedButton) return; // Click wasn't on a button

        // Get filter from data attribute
        const filterType = clickedButton.dataset.filter;
        if (!filterType) return;

        currentFilter = filterType;

        // Update active class
        filterButtons.forEach(btn => {
            btn.classList.remove('itmi-active');
        });
        clickedButton.classList.add('itmi-active');

        // Filter and re-render the table
        filterAndRender();
    }

    /**
     * Handles clicks on the star icons within the table body.
     */
    function handleStarClick(e) {
        // Find the star icon that was clicked
        const starIcon = e.target.closest('.itmi-star-icon');
        if (!starIcon) return; // Click wasn't on a star

        // Get the ID from the data attribute
        const itemId = parseInt(starIcon.dataset.id, 10);
        if (!itemId) return;

        // Find the corresponding item in the data
        const dataItem = allSectorData.find(item => item.id === itemId);
        if (!dataItem) return;

        // Toggle the favorite state
        dataItem.favorite = !dataItem.favorite;

        // Re-render the table
        // This will automatically update the star's class
        // and remove the item if we are in the 'Favorites' filter.
        filterAndRender();
    }

    // --- New Dropdown Handlers ---

    /**
     * Closes all open dropdown menus.
     */
    function closeAllDropdowns() {
        document.querySelectorAll('.itmi-dropdown-content').forEach(menu => {
            menu.classList.remove('itmi-dropdown-content-show');
        });
    }

    /**
     * Handles clicks on the dropdown toggle buttons.
     */
    function handleDropdownToggle(e) {
        // Use currentTarget to ensure we get the button, even if svg is clicked
        const button = e.currentTarget;
        const menuId = button.dataset.toggle;
        const menu = document.getElementById(menuId);

        if (!menu) return;

        // Check if this menu is already open
        const isAlreadyOpen = menu.classList.contains('itmi-dropdown-content-show');
        
        // Close all others first
        closeAllDropdowns();

        // If it wasn't already open, open it
        if (!isAlreadyOpen) {
            menu.classList.add('itmi-dropdown-content-show');
        }
    }

    /**
     * Handles clicks on items within a dropdown menu.
     */
    function handleDropdownItemClick(e) {
        e.preventDefault(); // Stop <a> tag from navigating
        const item = e.target.closest('.itmi-dropdown-item');
        if (!item) return;

        const newValue = item.dataset.value;
        const dropdownMenu = item.closest('.itmi-dropdown-content');
        
        if (!dropdownMenu || !newValue) return;

        // Update the button text
        if (dropdownMenu.id === 'itmi-currency-dropdown' && currencyBtn) {
            // Update text node, keeping svg intact
            currencyBtn.childNodes[0].nodeValue = `${newValue} `; 
        } else if (dropdownMenu.id === 'itmi-category-dropdown' && categoryBtn) {
            // Update text node, keeping svg intact
            categoryBtn.childNodes[0].nodeValue = `${newValue} `; 
        }
        
        console.log(`Dropdown item selected: ${newValue}`);
        // Add logic here to filter data or change currency (not implemented)

        closeAllDropdowns();
    }

    // Close dropdowns if clicking outside
    window.addEventListener('click', (e) => {
        // Check if the click is on a dropdown button or inside a dropdown menu
        if (!e.target.closest('.itmi-dropdown-btn') && !e.target.closest('.itmi-dropdown-content')) {
            closeAllDropdowns();
        }
    });

    // --- 7. Initial Setup ---

    // Add event listeners
    if (filterButtonGroup) {
        filterButtonGroup.addEventListener('click', handleFilterClick);
    }
    if (tableBody) {
        tableBody.addEventListener('click', handleStarClick);
    }

    // Add new event listeners for dropdowns
    dropdownButtons.forEach(button => {
        button.addEventListener('click', handleDropdownToggle);
    });

    document.querySelectorAll('.itmi-dropdown-content').forEach(menu => {
        menu.addEventListener('click', handleDropdownItemClick);
    });

    // Initial table render on page load
    filterAndRender();
});
</script>